<!DOCTYPE html>
<html>
<head>
    <title>AIçœŸå®æ€§éªŒè¯æµ‹è¯•</title>
</head>
<body>
    <h1>AIçœŸå®æ€§éªŒè¯æµ‹è¯•</h1>
    <p>æµ‹è¯•ç›¸åŒè¾“å…¥æ˜¯å¦å¾—åˆ°ä¸åŒçš„AIå›å¤</p>
    <button onclick="testMultipleTimes()">è¿ç»­æµ‹è¯•3æ¬¡</button>
    <div id="debugInfo" style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; white-space: pre-wrap;"></div>
    <div id="results"></div>
    
    <script>
    function log(message) {
        const debugInfo = document.getElementById('debugInfo');
        debugInfo.innerHTML += new Date().toLocaleTimeString() + ' - ' + message + '\n';
        console.log(message);
    }
    
    async function testMultipleTimes() {
        const results = document.getElementById('results');
        results.innerHTML = '';
        log('å¼€å§‹AIçœŸå®æ€§éªŒè¯æµ‹è¯•...');
        
        // å®Œå…¨ç›¸åŒçš„å°å…­å£¬å‚æ•°
        const card = 'A';
        const num1 = 1;
        const num2 = 1;
        const weather = 'æ™´';
        const mood = 'å¼€å¿ƒ';
        
        log(`å›ºå®šå‚æ•°: ç‰Œ=${card}, æ•°å­—=${num1},${num2}, å¤©æ°”=${weather}, å¿ƒæƒ…=${mood}`);
        
        // å°å…­å£¬è®¡ç®—
        const cardValues = {'A': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13};
        const cardNum = cardValues[card];
        const total = cardNum + num1 + num2;
        const remainder = total % 6;
        const guaIndex = remainder === 0 ? 5 : remainder - 1;
        const guaXiang = ['å¤§å®‰', 'ç•™è¿', 'é€Ÿå–œ', 'èµ¤å£', 'å°å‰', 'ç©ºäº¡'][guaIndex];
        
        log(`å°å…­å£¬ç»“æœ: ${total} % 6 = ${remainder} â†’ å¦è±¡: ${guaXiang}`);
        
        // è¿ç»­æµ‹è¯•3æ¬¡
        for (let i = 1; i <= 3; i++) {
            log(`\n--- ç¬¬${i}æ¬¡æµ‹è¯• ---`);
            
            try {
                const response = await fetch('http://localhost:3001/api/ai-fortune', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        card: card,
                        num1: num1,
                        num2: num2,
                        weather: weather,
                        mood: mood,
                        guaXiang: guaXiang
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const aiText = data.data.aiè§£è¯»;
                    const first100Chars = aiText.substring(0, 100);
                    
                    log(`ç¬¬${i}æ¬¡AIå›å¤: ${first100Chars}...`);
                    
                    results.innerHTML += `
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <h3>ç¬¬${i}æ¬¡æµ‹è¯•ç»“æœ</h3>
                            <p><strong>å¦è±¡:</strong> ${data.data.å¦è±¡}</p>
                            <p><strong>AIå›å¤å‰100å­—:</strong></p>
                            <div style="background: rgba(0,0,0,0.05); padding: 10px; border-radius: 5px;">
                                ${first100Chars}...
                            </div>
                            <p style="font-size: 12px; color: #666;">æ—¶é—´: ${data.data.æ—¶é—´}</p>
                        </div>
                    `;
                } else {
                    log(`ç¬¬${i}æ¬¡æµ‹è¯•å¤±è´¥: ${response.status}`);
                    results.innerHTML += `<p style="color: red;">ç¬¬${i}æ¬¡æµ‹è¯•å¤±è´¥</p>`;
                }
                
                // ç­‰å¾…2ç§’å†æµ‹è¯•ä¸‹ä¸€æ¬¡
                if (i < 3) {
                    log('ç­‰å¾…2ç§’...');
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
                
            } catch (error) {
                log(`ç¬¬${i}æ¬¡æµ‹è¯•é”™è¯¯: ${error.message}`);
                results.innerHTML += `<p style="color: red;">ç¬¬${i}æ¬¡æµ‹è¯•é”™è¯¯: ${error.message}</p>`;
            }
        }
        
        log('\nâœ… æµ‹è¯•å®Œæˆï¼å¦‚æœ3æ¬¡ç»“æœå†…å®¹ä¸åŒï¼Œè¯´æ˜AIçœŸæ­£åœ¨å·¥ä½œï¼');
        results.innerHTML += `
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin: 15px 0;">
                <h3>ğŸ¯ éªŒè¯ç»“è®º</h3>
                <p>å¦‚æœä¸Šé¢3æ¬¡æµ‹è¯•çš„AIå›å¤å†…å®¹æœ‰æ˜æ˜¾å·®å¼‚ï¼Œè¯´æ˜ç³»ç»ŸçœŸæ­£è°ƒç”¨äº†AI APIï¼</p>
                <p>å¦‚æœå†…å®¹å®Œå…¨ç›¸åŒï¼Œåˆ™å¯èƒ½æ˜¯å¤‡ç”¨ç®—æ³•åœ¨è¿è¡Œã€‚</p>
            </div>
        `;
    }
    </script>
</body>
</html>