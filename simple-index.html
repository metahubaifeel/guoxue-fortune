<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å¸ˆå‚…æ¥ä¸€å¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #8b4513;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .subtitle {
            color: #a0522d;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        
        .card-selection {
            margin: 30px 0;
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .card {
            background: linear-gradient(135deg, #f5f0e6 0%, #e8dfd0 100%);
            border: 3px solid #d4c5b0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5em;
            font-weight: bold;
            color: #8b4513;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border-color: #8b4513;
        }
        
        .card.selected {
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            color: white;
            border-color: #654321;
        }
        
        .input-group {
            margin: 25px 0;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #8b4513;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #d4c5b0;
            border-radius: 10px;
            font-size: 1.1em;
            background: #f5f0e6;
            color: #8b4513;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #8b4513;
            box-shadow: 0 0 10px rgba(139, 69, 19, 0.3);
        }
        
        .btn {
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 30px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 69, 19, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #f5f0e6 0%, #e8dfd0 100%);
            border-radius: 20px;
            border: 2px solid #d4c5b0;
            display: none;
        }
        
        .result.show {
            display: block;
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .loading-emoji {
            font-size: 3rem;
            animation: bounce 2s infinite;
            margin-bottom: 20px;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .loading-text {
            font-size: 1.5em;
            color: #8b4513;
            margin-bottom: 10px;
        }
        
        .loading-subtext {
            color: #a0522d;
            font-style: italic;
        }
        
        .fortune-content {
            line-height: 1.8;
            font-size: 1.1em;
            color: #5d4037;
        }
        
        .fortune-base {
            background: rgba(139, 69, 19, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #8b4513;
        }
        
        .fortune-paragraph {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            border-left: 3px solid #d4c5b0;
        }
        
        .fortune-guaxiang {
            color: #8b4513;
            font-weight: bold;
            background: rgba(139, 69, 19, 0.1);
            padding: 2px 6px;
            border-radius: 5px;
        }
        
        .fortune-weather {
            color: #4682b4;
            font-weight: bold;
        }
        
        .fortune-mood {
            color: #9370db;
            font-weight: bold;
        }
        
        .fortune-key-advice {
            color: #2e8b57;
            font-weight: bold;
            background: rgba(46, 139, 87, 0.1);
            padding: 2px 6px;
            border-radius: 5px;
            border: 1px solid rgba(46, 139, 87, 0.3);
        }
        
        .fortune-number {
            color: #ff6b6b;
            font-weight: bold;
            background: rgba(255, 107, 107, 0.1);
            padding: 2px 6px;
            border-radius: 50%;
        }
        
        .fortune-category {
            color: #cd853f;
            font-weight: bold;
            background: rgba(205, 133, 63, 0.1);
            padding: 4px 8px;
            border-radius: 8px;
            border-left: 3px solid #cd853f;
            margin: 10px 0 5px 0;
            display: inline-block;
        }
        
        .fortune-advice-title {
            color: #8b4513;
            font-weight: bold;
            font-size: 1.2em;
            background: rgba(139, 69, 19, 0.1);
            padding: 8px 12px;
            border-radius: 10px;
            border: 2px solid rgba(139, 69, 19, 0.3);
            margin: 15px 0;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .card-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .card {
                padding: 15px;
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å°å¸ˆå‚…æ¥ä¸€å¦</h1>
        <p class="subtitle">éšå¿ƒæŠ½å–ä¸€å¼ ç‰Œï¼Œè§£é”ä»Šæ—¥è¿åŠ¿</p>
        
        <div class="card-selection">
            <label>ğŸ¯ é€‰æ‹©ä¸€å¼ æ‰‘å…‹ç‰Œï¼š</label>
            <div class="card-grid" id="cardGrid">
                <div class="card" data-card="A">A â™ ï¸</div>
                <div class="card" data-card="2">2 â™¥ï¸</div>
                <div class="card" data-card="3">3 â™£ï¸</div>
                <div class="card" data-card="4">4 â™¦ï¸</div>
                <div class="card" data-card="5">5 â™ ï¸</div>
                <div class="card" data-card="6">6 â™¥ï¸</div>
                <div class="card" data-card="7">7 â™£ï¸</div>
                <div class="card" data-card="8">8 â™¦ï¸</div>
                <div class="card" data-card="9">9 â™ ï¸</div>
                <div class="card" data-card="10">10 â™¥ï¸</div>
                <div class="card" data-card="J">J â™£ï¸</div>
                <div class="card" data-card="Q">Q â™¦ï¸</div>
                <div class="card" data-card="K">K â™ ï¸</div>
            </div>
        </div>
        
        <div class="input-group">
            <label>ğŸ”¢ è¾“å…¥ä¸¤ä¸ªå¹¸è¿æ•°å­—ï¼ˆ1-99ï¼‰ï¼š</label>
            <input type="number" id="num1" placeholder="ç¬¬ä¸€ä¸ªæ•°å­—" min="1" max="99" value="1">
            <input type="number" id="num2" placeholder="ç¬¬äºŒä¸ªæ•°å­—" min="1" max="99" value="1">
        </div>
        
        <div class="input-group">
            <label>ğŸŒ¤ï¸ ä»Šæ—¥å¤©æ°”ï¼š</label>
            <select id="weather">
                <option value="æ™´">æ™´å¤©</option>
                <option value="é˜´">é˜´å¤©</option>
                <option value="é›¨">é›¨å¤©</option>
                <option value="é›ª">é›ªå¤©</option>
                <option value="é£">å¤§é£</option>
            </select>
        </div>
        
        <div class="input-group">
            <label>ğŸ˜Š å½“å‰å¿ƒæƒ…ï¼š</label>
            <select id="mood">
                <option value="å¼€å¿ƒ">å¼€å¿ƒ</option>
                <option value="å¹³é™">å¹³é™</option>
                <option value="ç„¦è™‘">ç„¦è™‘</option>
                <option value="æœŸå¾…">æœŸå¾…</option>
                <option value="çƒ¦èº">çƒ¦èº</option>
            </select>
        </div>
        
        <button class="btn" id="startBtn" onclick="startFortune()">ğŸ”® å¼€å§‹å åœ</button>
        
        <div class="loading" id="loading" style="display: none;">
            <div class="loading-emoji">ğŸ”®</div>
            <div class="loading-text">å°å¸ˆå‚…æ­£åœ¨èµ·å¦ä¸­</div>
            <div class="loading-subtext">å¤©æœºä¸å¯æ³„éœ²ï¼Œå®¹æˆ‘ææŒ‡ä¸€ç®—</div>
        </div>
        
        <div class="result" id="result">
            <div class="fortune-content" id="fortuneContent"></div>
        </div>
    </div>

    <script>
        // å°å…­å£¬ç®—æ³•
        function calculateXiaoLiuRen(card, num1, num2) {
            const cardValues = {'A': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13};
            const cardNum = cardValues[card];
            const total = cardNum + parseInt(num1) + parseInt(num2);
            const remainder = total % 6;
            const guaIndex = remainder === 0 ? 5 : remainder - 1;
            const guaXiang = ['å¤§å®‰', 'ç•™è¿', 'é€Ÿå–œ', 'èµ¤å£', 'å°å‰', 'ç©ºäº¡'];
            
            return {
                å¦è±¡: guaXiang[guaIndex],
                è®¡ç®—è¿‡ç¨‹: `${cardNum} + ${num1} + ${num2} = ${total}, ${total} % 6 = ${remainder}`
            };
        }

        // è·å–å¦è±¡è¯—è¯
        function getGuaXiangPoem(guaXiang) {
            const poems = {
                'å¤§å®‰': 'å¤§å®‰äº‹äº‹æ˜Œï¼Œæ±‚è´¢åœ¨å¤æ–¹ã€‚å¤±ç‰©å»ä¸è¿œï¼Œå®…èˆä¿å®‰åº·ã€‚',
                'ç•™è¿': 'ç•™è¿äº‹éš¾æˆï¼Œæ±‚è°‹æ—¥æœªæ˜ã€‚å®˜äº‹åªå®œç¼“ï¼Œå»è€…æœªå›ç¨‹ã€‚',
                'é€Ÿå–œ': 'é€Ÿå–œå–œæ¥ä¸´ï¼Œæ±‚è´¢å‘å—è¡Œã€‚å¤±ç‰©ç”³æœªåˆï¼Œé€¢äººè·¯ä¸Šå¯»ã€‚',
                'èµ¤å£': 'èµ¤å£ä¸»å£èˆŒï¼Œå®˜éåˆ‡è¦é˜²ã€‚å¤±ç‰©æ€¥å»å¯»ï¼Œè¡Œäººæœ‰æƒŠæ…Œã€‚',
                'å°å‰': 'å°å‰æœ€å‰æ˜Œï¼Œè·¯ä¸Šå¥½å•†é‡ã€‚é˜´äººæ¥æŠ¥å–œï¼Œå¤±ç‰©åœ¨å¤æ–¹ã€‚',
                'ç©ºäº¡': 'ç©ºäº¡äº‹ä¸ç¥¥ï¼Œé˜´äººå¤šä¹–å¼ ã€‚æ±‚è´¢æ— åˆ©ç›Šï¼Œè¡Œäººæœ‰ç¾æ®ƒã€‚'
            };
            return poems[guaXiang] || 'å¦è±¡æœªæ˜ï¼Œéœ€è°¨æ…è¡Œäº‹ã€‚';
        }

        // æ ¼å¼åŒ–è¿åŠ¿å†…å®¹
        function formatFortuneContent(content) {
            // æ›¿æ¢å¸¸è§çš„æ ‡ç‚¹ç¬¦å·ï¼Œä¼˜åŒ–æ’ç‰ˆ
            content = content.replace(/ã€‚/g, 'ã€‚<br>');
            content = content.replace(/ï¼/g, 'ï¼<br>');
            content = content.replace(/ï¼Ÿ/g, 'ï¼Ÿ<br>');
            content = content.replace(/ï¼›/g, 'ï¼›<br>');
            
            // å¤„ç†æ•°å­—åˆ—è¡¨
            content = content.replace(/(\d+)[\.ã€]/g, '<br><strong class="fortune-number">$1.</strong>');
            
            // å¤„ç†å»ºè®®éƒ¨åˆ†
            content = content.replace(/å»ºè®®[ï¼š:]/g, '<br><strong class="fortune-advice-title">å»ºè®®ï¼š</strong>');
            content = content.replace(/ä»Šæ—¥å»ºè®®[ï¼š:]/g, '<br><strong class="fortune-advice-title">ä»Šæ—¥å»ºè®®ï¼š</strong>');
            
            // å¤„ç†å·¥ä½œã€å­¦ä¹ ã€ç”Ÿæ´»ç­‰æ–¹é¢
            content = content.replace(/å·¥ä½œ[ï¼š:]/g, '<br><strong class="fortune-category">å·¥ä½œï¼š</strong>');
            content = content.replace(/å­¦ä¹ [ï¼š:]/g, '<br><strong class="fortune-category">å­¦ä¹ ï¼š</strong>');
            content = content.replace(/ç”Ÿæ´»[ï¼š:]/g, '<br><strong class="fortune-category">ç”Ÿæ´»ï¼š</strong>');
            content = content.replace(/äººé™…[ï¼š:]/g, '<br><strong class="fortune-category">äººé™…ï¼š</strong>');
            content = content.replace(/å¥åº·[ï¼š:]/g, '<br><strong class="fortune-category">å¥åº·ï¼š</strong>');
            content = content.replace(/è´¢è¿[ï¼š:]/g, '<br><strong class="fortune-category">è´¢è¿ï¼š</strong>');
            content = content.replace(/æ„Ÿæƒ…[ï¼š:]/g, '<br><strong class="fortune-category">æ„Ÿæƒ…ï¼š</strong>');
            
            // å¤„ç†å¦è±¡åç§°
            content = content.replace(/(å¤§å®‰|ç•™è¿|é€Ÿå–œ|èµ¤å£|å°å‰|ç©ºäº¡)/g, '<strong class="fortune-guaxiang">$1</strong>');
            
            // å¤„ç†å¤©æ°”å’Œå¿ƒæƒ…å…³é”®è¯
            content = content.replace(/(æ™´å¤©|é˜´å¤©|é›¨å¤©|é›ªå¤©|å¤§é£|æ™´æœ—)/g, '<strong class="fortune-weather">$1</strong>');
            content = content.replace(/(å¼€å¿ƒ|ç„¦è™‘|å¹³é™|å…´å¥‹|çƒ¦èº|å¿§éƒ|æœŸå¾…)/g, '<strong class="fortune-mood">$1</strong>');
            
            // é‡ç‚¹ï¼šå¤„ç†å®é™…çš„å»ºè®®æ€§å†…å®¹
            content = content.replace(/(ä¸»åŠ¨ä¸æœ‹å‹ã€åŒäº‹äº¤æµäº’åŠ¨|å…¶å®æ˜¯å……æ»¡æ´»åŠ›ä¸å¸Œæœ›çš„|ä¸è¦è¿‡äºå¹å˜˜æˆ–å¤¸å¤§å…¶è¯|ä¿æŒå¹³å’Œå¿ƒæ€|é¡ºå…¶è‡ªç„¶|æå‰åšå¥½å‡†å¤‡|å¤šç•™æ„ç»†èŠ‚|çµæ´»åº”å¯¹|ä¿æŒä¹è§‚|ç§¯æé¢å¯¹|è°¨æ…å¤„ç†|è®¤çœŸå¯¹å¾…|ç”¨å¿ƒç»è¥|æŠŠæ¡æœºä¼š|åŒ–è§£çŸ›ç›¾|å¢è¿›æ„Ÿæƒ…|æå‡è‡ªæˆ‘|è°ƒæ•´å¿ƒæ€|åšå¥½å‡†å¤‡|ç•™æœ‰ä½™åœ°|å¾ªåºæ¸è¿›|ç¨³æ‰ç¨³æ‰“|è„šè¸å®åœ°|é‡åŠ›è€Œè¡Œ|é€‚å¯è€Œæ­¢|è§å¥½å°±æ”¶|åŠæ—¶æ­¢æŸ|ä¿æŒå†·é™|ç†æ€§åˆ†æ|æ·±æ€ç†Ÿè™‘|å…¨é¢è€ƒè™‘|æƒè¡¡åˆ©å¼Š|åšå‡ºé€‰æ‹©|æ‰¿æ‹…è´£ä»»|å‹‡äºé¢å¯¹|æ•¢äºå°è¯•|çªç ´è‡ªæˆ‘|å¼€æ‹“åˆ›æ–°|ä¸æ—¶ä¿±è¿›|ä¸æ–­å­¦ä¹ |ç§¯ç´¯ç»éªŒ|æå‡èƒ½åŠ›|å®Œå–„è‡ªæˆ‘|è¿½æ±‚å“è¶Š|ç²¾ç›Šæ±‚ç²¾|è¿½æ±‚å®Œç¾|æ³¨é‡ç»†èŠ‚|æŠŠæ¡æ—¶æœº|æŠ¢å å…ˆæœº|èµ¢å¾—ä¸»åŠ¨|å æ®ä¼˜åŠ¿|è„±é¢–è€Œå‡º|å±•ç°è‡ªæˆ‘|å®ç°ä»·å€¼|è¾¾æˆç›®æ ‡|å®ç°æ¢¦æƒ³|è¿½æ±‚å¹¸ç¦|äº«å—ç”Ÿæ´»|çæƒœå½“ä¸‹|æ„Ÿæ©æ‹¥æœ‰|ä¿æŒåˆå¿ƒ|ä¸å¿˜æœ¬å¿ƒ|åšæŒåŸåˆ™|å®ˆä½åº•çº¿|ä¸è¶Šçº¢çº¿|è°¨è¨€æ…è¡Œ|ä¸‰æ€è€Œåè¡Œ|è°‹å®šè€ŒååŠ¨|å®¡æ—¶åº¦åŠ¿|éšæœºåº”å˜|å› åŠ¿åˆ©å¯¼|é¡ºåŠ¿è€Œä¸º|å€ŸåŠ¿å‘åŠ›|å€ŸåŠ›æ‰“åŠ›|ä»¥é€€ä¸ºè¿›|ä»¥å®ˆä¸ºæ”»|æ”»å®ˆå…¼å¤‡|è¿›é€€æœ‰åº¦|æ”¶æ”¾è‡ªå¦‚|å¼ å¼›æœ‰åº¦|åŠ³é€¸ç»“åˆ|æ¾ç´§é€‚åº¦|æŠŠæ¡åˆ†å¯¸|æŒæ¡ç«å€™|æ°åˆ°å¥½å¤„|é€‚å¯è€Œæ­¢|è§å¥½å°±æ”¶|ç©·å¯‡è«è¿½|é€¢å‡¶åŒ–å‰|è½¬å±ä¸ºå®‰|åŒ–é™©ä¸ºå¤·|é‡éš¾å‘ˆç¥¥|å¦ææ³°æ¥|æ—¶æ¥è¿è½¬|æŸ³æš—èŠ±æ˜|å³°å›è·¯è½¬|ç»å¤„é€¢ç”Ÿ|èµ·æ­»å›ç”Ÿ|è„±èƒæ¢éª¨|ç„•ç„¶ä¸€æ–°|é‡è·æ–°ç”Ÿ|é‡æ–°å¼€å§‹|é‡æ–°å‡ºå‘|ä»å¤´å†æ¥|å†æ¥å†å‰|ç™¾æŠ˜ä¸æŒ |æ°¸ä¸è¨€å¼ƒ|åšæŒä¸æ‡ˆ|æŒä¹‹ä»¥æ’|é”²è€Œä¸èˆ|é‡‘çŸ³å¯é•‚|æ°´æ»´çŸ³ç©¿|ç»³é”¯æœ¨æ–­|é“æµæˆé’ˆ|ç™¾ç‚¼æˆé’¢|åƒé”¤ç™¾ç‚¼|ç²¾ç›Šæ±‚ç²¾|è¿½æ±‚å®Œç¾|è‡³å–„è‡³ç¾|ç¾è½®ç¾å¥‚|å·§å¤ºå¤©å·¥|å‡ºç¥å…¥åŒ–|ç‚‰ç«çº¯é’|ç™»å³°é€ æ|æ— ä¸ä¼¦æ¯”|æ— å¯æ¯”æ‹Ÿ|å‰æ‰€æœªæœ‰|é—»æ‰€æœªé—»|è§æ‰€æœªè§)/g, '<strong class="fortune-key-advice">$1</strong>');
            
            return content;
        }

        // ç”Ÿæˆå¤‡ç”¨è¿åŠ¿ï¼ˆå½“AIä¸å¯ç”¨æ—¶ï¼‰
        function generateFallbackFortune(guaXiang, weather, mood) {
            const poem = getGuaXiangPoem(guaXiang);
            
            const advice = {
                'å¤§å®‰': 'ä»Šæ—¥å¤§å®‰ï¼Œè¯¸äº‹é¡ºé‚ã€‚é€‚åˆå¼€å±•æ–°è®¡åˆ’ï¼ŒæŠŠæ¡æœºä¼šï¼Œä¿æŒç§¯æå¿ƒæ€ã€‚',
                'ç•™è¿': 'ä»Šæ—¥ç•™è¿ï¼Œå®œé™ä¸å®œåŠ¨ã€‚åšäº‹è¦æœ‰è€å¿ƒï¼Œä¸è¦æ€¥äºæ±‚æˆï¼Œå¤šè§‚å¯Ÿæ€è€ƒã€‚',
                'é€Ÿå–œ': 'ä»Šæ—¥é€Ÿå–œï¼Œå¥½æ¶ˆæ¯å³å°†åˆ°æ¥ã€‚ä¿æŒä¹è§‚ï¼Œç§¯æè¡ŒåŠ¨ï¼Œä¼šæœ‰æ„å¤–æ”¶è·ã€‚',
                'èµ¤å£': 'ä»Šæ—¥èµ¤å£ï¼Œæ³¨æ„è¨€è¡Œã€‚é¿å…äº‰æ‰§ï¼Œè°¨æ…å¤„ç†äººé™…å…³ç³»ï¼Œè¯´è¯è¦ä¸‰æ€ã€‚',
                'å°å‰': 'ä»Šæ—¥å°å‰ï¼Œå°æœ‰æ‰€å¾—ã€‚é€‚åˆå¤„ç†æ—¥å¸¸äº‹åŠ¡ï¼Œç§¯å°æˆå¤§ï¼Œç¨³æ­¥å‰è¿›ã€‚',
                'ç©ºäº¡': 'ä»Šæ—¥ç©ºäº¡ï¼Œå®œå®ˆä¸å®œæ”»ã€‚ä¿æŒä½è°ƒï¼Œé¿å…é‡å¤§å†³ç­–ï¼Œé™å¾…æ—¶æœºã€‚'
            };
            
            return `
                <div class="fortune-base">ä»Šæ—¥å¦è±¡ï¼š<strong class="fortune-guaxiang">${guaXiang}</strong></div>
                <p class="fortune-paragraph">å¦è±¡è§£æï¼š${poem}</p>
                <p class="fortune-paragraph">ä»Šæ—¥å»ºè®®ï¼š${advice[guaXiang]} ç»“åˆ${weather}å¤©æ°”å’Œæ‚¨çš„${mood}å¿ƒæƒ…ï¼Œå»ºè®®æ‚¨ä¿æŒå¹³å’Œå¿ƒæ€ï¼Œé¡ºå…¶è‡ªç„¶ã€‚</p>
                <p class="fortune-paragraph"><small>ï¼ˆä½¿ç”¨å¤‡ç”¨ç®—æ³•ç”Ÿæˆï¼‰</small></p>
            `;
        }

        // ä¸»è¦å‡½æ•°
        let selectedCard = null;

        // å¡ç‰‡é€‰æ‹©
        document.getElementById('cardGrid').addEventListener('click', function(e) {
            if (e.target.classList.contains('card')) {
                // ç§»é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // æ·»åŠ é€‰ä¸­çŠ¶æ€
                e.target.classList.add('selected');
                selectedCard = e.target.dataset.card;
            }
        });

        // å¼€å§‹å åœ
        async function startFortune() {
            // éªŒè¯è¾“å…¥
            if (!selectedCard) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€å¼ æ‰‘å…‹ç‰Œï¼');
                return;
            }
            
            const num1 = document.getElementById('num1').value;
            const num2 = document.getElementById('num2').value;
            const weather = document.getElementById('weather').value;
            const mood = document.getElementById('mood').value;
            
            if (!num1 || !num2) {
                alert('è¯·è¾“å…¥ä¸¤ä¸ªå¹¸è¿æ•°å­—ï¼');
                return;
            }
            
            if (parseInt(num1) < 1 || parseInt(num1) > 99 || parseInt(num2) < 1 || parseInt(num2) > 99) {
                alert('è¯·è¾“å…¥1-99ä¹‹é—´çš„æ•°å­—ï¼');
                return;
            }
            
            // è®¡ç®—å°å…­å£¬å¦è±¡
            const xiaoLiuRenResult = calculateXiaoLiuRen(selectedCard, num1, num2);
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('startBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').classList.remove('show');
            
            try {
                // å°è¯•è°ƒç”¨AI API
                const response = await fetch('https://xiaoshifu-fortune-production.up.railway.app/api/ai-fortune', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        card: selectedCard,
                        num1: num1,
                        num2: num2,
                        weather: weather,
                        mood: mood,
                        guaXiang: xiaoLiuRenResult.å¦è±¡
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        // AIç”Ÿæˆå†…å®¹æˆåŠŸ
                        const formattedContent = formatFortuneContent(data.data.aiè§£è¯»);
                        document.getElementById('fortuneContent').innerHTML = formattedContent;
                    } else {
                        // AIè¿”å›é”™è¯¯ï¼Œä½¿ç”¨å¤‡ç”¨ç®—æ³•
                        const fallbackContent = generateFallbackFortune(xiaoLiuRenResult.å¦è±¡, weather, mood);
                        document.getElementById('fortuneContent').innerHTML = fallbackContent;
                    }
                } else {
                    // APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨ç®—æ³•
                    const fallbackContent = generateFallbackFortune(xiaoLiuRenResult.å¦è±¡, weather, mood);
                    document.getElementById('fortuneContent').innerHTML = fallbackContent;
                }
                
            } catch (error) {
                // ç½‘ç»œé”™è¯¯ï¼Œä½¿ç”¨å¤‡ç”¨ç®—æ³•
                console.error('AI APIè°ƒç”¨å¤±è´¥:', error);
                const fallbackContent = generateFallbackFortune(xiaoLiuRenResult.å¦è±¡, weather, mood);
                document.getElementById('fortuneContent').innerHTML = fallbackContent;
            }
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('loading').style.display = 'none';
            document.getElementById('result').classList.add('show');
            document.getElementById('startBtn').disabled = false;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤å€¼
            document.getElementById('num1').value = Math.floor(Math.random() * 9) + 1;
            document.getElementById('num2').value = Math.floor(Math.random() * 9) + 1;
        });
    </script>
</body>
</html>