<!DOCTYPE html>
<html>
<head>
    <title>å®Œæ•´AIç®—å‘½æµ‹è¯•</title>
</head>
<body>
    <h1>å®Œæ•´AIç®—å‘½æµ‹è¯•</h1>
    <p>æµ‹è¯•çœŸå®çš„AIç®—å‘½æµç¨‹</p>
    <button onclick="testAIFortune()">æµ‹è¯•AIç®—å‘½</button>
    <div id="debugInfo" style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; white-space: pre-wrap;"></div>
    <div id="result"></div>
    
    <script>
    function log(message) {
        const debugInfo = document.getElementById('debugInfo');
        debugInfo.innerHTML += new Date().toLocaleTimeString() + ' - ' + message + '\n';
        console.log(message);
    }
    
    async function testAIFortune() {
        const result = document.getElementById('result');
        const debugInfo = document.getElementById('debugInfo');
        debugInfo.innerHTML = '';
        log('å¼€å§‹AIç®—å‘½æµ‹è¯•...');
        
        try {
            // æ­¥éª¤1: æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥
            const card = 'A';
            const num1 = 1;
            const num2 = 1;
            const weather = 'æ™´';
            const mood = 'å¼€å¿ƒ';
            
            log(`ç”¨æˆ·è¾“å…¥: ç‰Œ=${card}, æ•°å­—=${num1},${num2}, å¤©æ°”=${weather}, å¿ƒæƒ…=${mood}`);
            
            // æ­¥éª¤2: å°å…­å£¬ç®—æ³•
            const cardValues = {'A': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13};
            const cardNum = cardValues[card];
            const total = cardNum + num1 + num2;
            const remainder = total % 6;
            const guaIndex = remainder === 0 ? 5 : remainder - 1;
            const guaXiang = ['å¤§å®‰', 'ç•™è¿', 'é€Ÿå–œ', 'èµ¤å£', 'å°å‰', 'ç©ºäº¡'][guaIndex];
            
            log(`å°å…­å£¬è®¡ç®—: ${cardNum} + ${num1} + ${num2} = ${total}, ${total} % 6 = ${remainder} â†’ å¦è±¡: ${guaXiang}`);
            
            // æ­¥éª¤3: è°ƒç”¨ä»£ç†æœåŠ¡å™¨
            log('æ­£åœ¨è°ƒç”¨AIä»£ç†æœåŠ¡å™¨...');
            const response = await fetch('http://localhost:3001/api/ai-fortune', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    card: card,
                    num1: num1,
                    num2: num2,
                    weather: weather,
                    mood: mood,
                    guaXiang: guaXiang
                })
            });
            
            log(`ä»£ç†æœåŠ¡å™¨å“åº”çŠ¶æ€: ${response.status}`);
            
            if (response.ok) {
                const data = await response.json();
                log('æ”¶åˆ°AIå›å¤!');
                log(`AIå›å¤å†…å®¹: ${data.data.aiè§£è¯».substring(0, 100)}...`);
                
                result.innerHTML = `
                    <h2>ğŸ¯ AIç®—å‘½ç»“æœ</h2>
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h3>ä»Šæ—¥å¦è±¡: ${data.data.å¦è±¡}</h3>
                        <p><strong>AIå¤§å¸ˆè§£è¯»:</strong></p>
                        <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 10px 0;">
                            ${data.data.aiè§£è¯»}
                        </div>
                        <p style="font-size: 12px; opacity: 0.8;">ç”Ÿæˆæ—¶é—´: ${data.data.æ—¶é—´}</p>
                    </div>
                    <p style="color: green; font-size: 18px;">âœ… çœŸå®AIç®—å‘½æˆåŠŸ! æ¯æ¬¡ç»“æœéƒ½ä¼šä¸åŒ!</p>
                `;
            } else {
                const errorData = await response.json();
                log(`ä»£ç†æœåŠ¡å™¨é”™è¯¯: ${errorData.error}`);
                result.innerHTML = `<p style="color: red;">âŒ ä»£ç†æœåŠ¡å™¨é”™è¯¯: ${errorData.error}</p>`;
            }
            
        } catch (error) {
            log(`å®Œå…¨å¤±è´¥: ${error.message}`);
            result.innerHTML = `<p style="color: red;">âŒ å®Œå…¨å¤±è´¥: ${error.message}</p>`;
            console.error('å®Œæ•´é”™è¯¯:', error);
        }
    }
    </script>
</body>
</html>